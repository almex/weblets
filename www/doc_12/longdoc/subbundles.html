<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'/>
    <meta http-equiv="X-UA-Compatible" content="chrome=1"/>
    <meta name="description" content="Weblets : weblets full project mirror"/>

    <link rel="stylesheet" type="text/css" media="screen" href="../../../stylesheets/stylesheet.css">

    <title>Weblets Subbundles Guide</title>
</head>

<body>

<!-- HEADER -->
<div id="header_wrap" class="outer">
    <header class="inner">
        <a id="forkme_banner" href="https://github.com/werpu/weblets">View on GitHub</a>

        <h1 id="project_title">Weblets</h1>

        <h2 id="project_tagline">weblets full project mirror</h2>

        <section id="downloads">
            <a class="zip_download_link" href="https://github.com/werpu/weblets/zipball/master">Download this project as
                a .zip file</a>
            <a class="tar_download_link" href="https://github.com/werpu/weblets/tarball/master">Download this project as
                a tar.gz file</a>
        </section>
    </header>
</div>

<!-- MAIN CONTENT -->
<div id="main_content_wrap" class="outer">
    <section id="main_content" class="inner">
        <h2>Subbundles</h2>

        <p> As of
            <emph>Weblets</emph>
            1.2 the possibility of subbundles has been added to the weblets core.
            Subbundles are simply bundles within bundles which enable certain functionality.
        </p>
        The reason for the introduction of this new mechanism have been several constraints
        and future extension points which are needed or have to be avoided in the average webapp.
        <p/>
        Lets take a look at the subbundles from the problem point of view.
        <p/>
        An average page request has several includes for instance an include to three javascript
        files several css files.
        <p/>
        Under normal circumstances you have one request per include, even if the request is served out of
        the cache, which happens in 20-40% of all request that means a significant slowdown because
        every request has to be processed separately by the browser.
        <p/>
        Additionally to that if no cache is active or we have an empty cache hit, the server
        has to endure a series of requests per page request to serve the needed resources!
        Under normal circumstances it makes sense to bundle several resources which can be grouped
        together, to reduce both browser processing time and server load!
        <p>Now to resolve this issue we have two tools.</p>
        <ul>
            <li>Our indirection API</li>
            </li>The subbundles</li>
        </ul>
        Subbundles to make it short are a simple, but elegant extension to deal with the problem!
        <h2>General Mechanism</h2>
        Subbundles are lists of resources which are internally concatenated and by utilizing the indirection
        api replaced with a single include call on the fly!
        <p/>
        <!-- HTML generated using hilite.me -->
        <div style="background: #ffffff; overflow:auto;width:auto;color:black;background:white;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre
                style="margin: 0; line-height: 125%"><span style="color: #007000">&lt;weblet&gt;</span>
    <span style="color: #007000">&lt;weblet-name&gt;</span>weblets.demo<span
                    style="color: #007000">&lt;/weblet-name&gt;</span>
    <span style="color: #007000">&lt;weblet-class&gt;</span>
        net.java.dev.weblets.packaged.PackagedWeblet
    <span style="color: #007000">&lt;/weblet-class&gt;</span>
    <span style="color: #007000">&lt;weblet-version&gt;</span>1.0<span
                    style="color: #007000">&lt;/weblet-version&gt;</span>

    <span style="color: #007000">&lt;subbundle&gt;</span>
        <span style="color: #007000">&lt;id&gt;</span>scripts/bundlescript1.js<span
                    style="color: #007000">&lt;/id&gt;</span>
        <span style="color: #007000">&lt;resources&gt;</span>
            /scripts/script1.js,
            /scripts/script2.js,
            /scripts/script3.js
        <span style="color: #007000">&lt;/resources&gt;</span>
    <span style="color: #007000">&lt;/subbundle&gt;</span>


    <span style="color: #007000">&lt;subbundle&gt;</span>
        <span style="color: #007000">&lt;id&gt;</span>scripts/cssbundle1.css<span
                    style="color: #007000">&lt;/id&gt;</span>
        <span style="color: #007000">&lt;resources&gt;</span>
            css/css1.css, css/css2.css, css/css3.css
        <span style="color: #007000">&lt;/resources&gt;</span>
    <span style="color: #007000">&lt;/subbundle&gt;</span>
<span style="color: #007000">&lt;/weblet&gt;</span>
        </pre>
        </div>
        <p/>
        In this example two bundles are defined,
        both bundles are concatenated at indirection access to
        the resource name defined in the &lt;id\&gt; field!
        <p/>
        Now what happens at access time?
        The indirection api resolves the first request into the bundle
        to the resource defined in &lt;id\&gt; and ever other resource into
        empty strings, thus omitting the additional requests.
        <p/>

        All resources in the bundle are concatenated on the fly and served as a single resources.
        <p/>
        Now what happens if those resources are accessed directly?
        <ul>
            <li>The first access sends the entire bundle!</li>
            <li>all other accesses send empty strings.</li>
        </ul>

        Now for some situations this might be suitable, for instance an empty CSS include does nothing. In other
        situations
        such a thing might trigger a browser error.
        <p/>
        To cope with this an API has been added which allows to check for already included resources!
        <p/>
        <!-- HTML generated using hilite.me -->
        <div style="background: #ffffff; overflow:auto;width:auto;color:black;background:white;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre
                style="margin: 0; line-height: 125%">WebletUtils<span style="color: #303030">.</span><span
                style="color: #0000C0">isResourceLoaded</span><span style="color: #303030">(</span>Servlet<span
                style="color: #303030">/</span>Portletrequest request<span style="color: #303030">,</span>  String weblet<span
                style="color: #303030">,</span> String pathInfo<span style="color: #303030">)</span>
        </pre>
        </div>
        As general utils method
        <p/>
        <!-- HTML generated using hilite.me -->
        <div style="background: #ffffff; overflow:auto;width:auto;color:black;background:white;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre
                style="margin: 0; line-height: 125%"><span style="color: #008000; font-weight: bold">public</span> <span
                style="color: #008000; font-weight: bold">static</span> <span style="color: #303090; font-weight: bold">boolean</span> FacesWebletUtils<span
                style="color: #303030">.</span><span style="color: #0000C0">isResourceLoaded</span><span
                style="color: #303030">(</span>FacesContext context<span
                style="color: #303030">,</span> String weblet<span style="color: #303030">,</span> String pathInfo<span
                style="color: #303030">)</span>
        </pre>
        </div>
        As JSF utils method
        <p/>
        <!-- HTML generated using hilite.me -->
        <div style="background: #ffffff; overflow:auto;width:auto;color:black;background:white;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre
                style="margin: 0; line-height: 125%"><span style="color: #507090">#{</span><span
                style="color: #0060B0; font-weight: bold">isResourceLoaded</span>(<span
                style="color: #0060B0; font-weight: bold">weblet</span>, <span
                style="color: #0060B0; font-weight: bold">pathInfo</span>)}
        </pre>
        </div>
        As EL helper function

        <div class="section"><h3>Contents</h3>
            <ol type="1">
                <li><a href="./index.html"> Users documentation: Index </a>
                </li>
                <li><a href="./whatsnew.html"> What is new in this release </a>
                </li>
                <li><a href="./gettingstarted.html"> Users documentation: Getting started </a>
                </li>
                <li><a href="./setup.html"> Users documentation: Setup guide </a>
                </li>
                <li><a href="./generalapi.html"> Users documentation: Introduction to the api patterns </a>
                </li>
                <li><a href="./usagejsp.html"> Users documentation: JSP Weblets usage guide </a>
                </li>
                <li><a href="./usagejava.html"> Users documentation: Servlet Weblets usage guide </a>
                </li>
                <li><a href="./usagejsf.html"> Users documentation: JSF Weblets usage guide </a>
                </li>
                <li><a href="./usageresources.html"> Users documentation: Resources Weblets usage guide </a>
                </li>
                <li><a href="./packingweblets.html"> Users documentation: Weblets packaging guide </a>
                </li>
                <li><a href="./subbundles.html"> Users documentation: Weblets Subbundles </a>
                </li>

                <li><a href="./reporting.html"> Users documentation: Weblets reporting guide </a>
                </li>
                <li><a href="./programmingweblets.html"> Developers documentation: Programming Weblets </a>
                </li>
                <li><a href="./faq.html"> Users documentation: Weblets general FAQ </a>
                </li>
            </ol>
        </div>
    </section>
</div>
</body>
</html>